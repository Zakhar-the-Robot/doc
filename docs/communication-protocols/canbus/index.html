<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ZakharCAN (ver. 0.0.0) #  The standard is based on the CAN bus protocol. Base CAN configuration:
 Bitrate: 125 kbits/s ID: 11 bits  In the standard there are several common parameters:
 Common timeout: 3 sec Dev ID size: 3 bits Data ID size: 4 bits  Addressing #  Each device uses 3 highest bits of the 11-bit ID for it&rsquo;s ID (0..7). The last 4 bits are used for different data types (0."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="ZakharCAN (ver. 0.0.0) #  The standard is based on the CAN bus protocol. Base CAN configuration:
 Bitrate: 125 kbits/s ID: 11 bits  In the standard there are several common parameters:
 Common timeout: 3 sec Dev ID size: 3 bits Data ID size: 4 bits  Addressing #  Each device uses 3 highest bits of the 11-bit ID for it&rsquo;s ID (0..7). The last 4 bits are used for different data types (0."><meta property="og:type" content="article"><meta property="og:url" content="https://zakhar-the-robot.github.io/doc/docs/communication-protocols/canbus/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-05-07T00:39:39+02:00"><title>Canbus | Zakhar the Robot</title><link rel=manifest href=/doc/manifest.json><link rel=icon href=/doc/favicon.png type=image/x-icon><link rel=stylesheet href=/doc/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous><script defer src=/doc/flexsearch.min.js></script>
<script defer src=/doc/en.search.min.cc2918632c8e2988523bff142e5dd4be49abac6548ddcdc68bcbffb0ee364f1f.js integrity="sha256-zCkYYyyOKYhSO/8ULl3UvkmrrGVI3c3Gi8v/sO42Tx8=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/doc/><span>Zakhar the Robot</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><span>Communication Protocols</span><ul><li><a href=/doc/docs/communication-protocols/canbus/ class=active>Canbus</a></li><li><a href=/doc/docs/communication-protocols/i2c-deprecated/>I2c ( Deprecated)</a><ul></ul></li></ul></li><li><span>Gears</span><ul><li><a href=/doc/docs/gears/brain/>Brain</a><ul><li><a href=/doc/docs/gears/brain/ros_install/>Ros Install</a></li></ul></li><li><a href=/doc/docs/gears/io/>IO</a><ul></ul></li><li><a href=/doc/docs/gears/motors/>Motors</a><ul></ul></li></ul></li><li><a href=/doc/docs/devices/>Devices (Work in Progress)</a></li></ul><ul><li><a href=https://github.com/Zakhar-the-Robot/zakhar target=_blank rel=noopener>Sources â†—</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/doc/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Canbus</strong>
<label for=toc-control><img src=/doc/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#addressing>Addressing</a></li><li><a href=#standard-versioning>Standard Versioning</a></li><li><a href=#internal-error-codes>Internal Error Codes</a></li><li><a href=#data-types>Data Types</a></li><li><a href=#operations>Operations</a><ul><li><a href=#send-data>Send data</a></li><li><a href=#request-data>Request data</a></li><li><a href=#declare-the-presence>Declare the Presence</a></li></ul></li><li><a href=#compatible-libraries>Compatible libraries</a></li></ul></nav></aside></header><article class=markdown><h1 id=zakharcan-ver-000>ZakharCAN (ver. 0.0.0)
<a class=anchor href=#zakharcan-ver-000>#</a></h1><p>The standard is based on the CAN bus protocol. Base CAN configuration:</p><ul><li>Bitrate: 125 kbits/s</li><li>ID: 11 bits</li></ul><p>In the standard there are several common parameters:</p><ul><li>Common timeout: 3 sec</li><li>Dev ID size: 3 bits</li><li>Data ID size: 4 bits</li></ul><h2 id=addressing>Addressing
<a class=anchor href=#addressing>#</a></h2><p>Each device uses 3 highest bits of the 11-bit ID for it&rsquo;s ID (0..7). The last 4 bits are used for different data types (0..15). Bits from 5 to 8 are reserved for future use.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span> 0b   X X X   X X X X   X X X X
</span></span><span style=display:flex><span>    |-------|---------|---------|
</span></span><span style=display:flex><span>     Address  Reserved  Data ID
</span></span></code></pre></td></tr></table></div></div><p>Example of the device id 0x104:</p><ul><li>Device Address: 0x1</li><li>Data ID: 0x4</li></ul><h2 id=standard-versioning>Standard Versioning
<a class=anchor href=#standard-versioning>#</a></h2><p>Note: <strong>Until version 1.0.0 this section can be violated</strong></p><p>The version consists of 3 numbers: <code>Major</code>.<code>Minor</code>.<code>Patch</code> (e.g. 2.3.9)</p><ul><li>All devices using the same <code>Major</code> should be able to interact with each other</li><li>All devices using the same <code>Minor</code> should be able to interact with each other and have to have the same feature set</li></ul><h2 id=internal-error-codes>Internal Error Codes
<a class=anchor href=#internal-error-codes>#</a></h2><table><thead><tr><th>Code</th><th>Name</th></tr></thead><tbody><tr><td>0x0</td><td>OK</td></tr><tr><td>0x1</td><td>TIMEOUT_ERROR</td></tr><tr><td>0xFF</td><td>GENERAL_ERROR</td></tr></tbody></table><h2 id=data-types>Data Types
<a class=anchor href=#data-types>#</a></h2><table><thead><tr><th>Data ID</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>0x0</td><td>DeviceInfo</td><td>Used for presence declaration each <strong>Common timeout</strong> (see details bellow). In response for the request should return a data frame with <code>DATA[0]</code>:<code>Major</code>, <code>DATA[1]</code>:<code>Minor</code>, <code>DATA[2]</code>:<code>Patch</code></td></tr><tr><td>0x1</td><td></td><td>Reserved for future</td></tr><tr><td>0x2&mldr;0x15</td><td>DeviceData</td><td>Device specific data defined by each device.</td></tr></tbody></table><h2 id=operations>Operations
<a class=anchor href=#operations>#</a></h2><h3 id=send-data>Send data
<a class=anchor href=#send-data>#</a></h3><ol><li>Send a CAN frame:<ul><li>Identifier: <code>(DevID &lt;&lt; 8) | DataID</code></li><li>RTR: 0x0</li><li>Data length code (DLC): 0x0..0x8</li><li>Data: 0&mldr;8 bytes</li></ul></li></ol><h3 id=request-data>Request data
<a class=anchor href=#request-data>#</a></h3><ol><li><p>Send a CAN frame:</p><ul><li>Identifier: <code>(DevID &lt;&lt; 8) | DataID</code> (ID of the requested data!)</li><li>RTR: 0x1</li><li>Data length code (DLC): 0x0</li><li>Data: 0 bytes</li></ul></li><li><p>Wait for a message with the requested ID during the <strong>Common timeout</strong></p></li><li><p>If the message has come: <code>OK</code>, overwise: <code>TIMEOUT_ERROR</code></p></li></ol><h3 id=declare-the-presence>Declare the Presence
<a class=anchor href=#declare-the-presence>#</a></h3><p>A device is online if it declares its presence on the line each <strong>Common timeout</strong>.</p><p>To declare being online the device should:</p><ol><li>Send a CAN frame:<ul><li>Identifier: <code>DevID &lt;&lt; 8</code> (0xN00)</li><li>RTR: 0x0</li><li>Data length code (DLC): 0x0</li><li>Data: 0 bytes</li></ul></li></ol><h2 id=compatible-libraries>Compatible libraries
<a class=anchor href=#compatible-libraries>#</a></h2><p>Libraries bellow are developed inside the Zakhar project and support ZakharCAN.</p><ul><li>Arduino: <a href=https://github.com/an-dr/zklib_arduino_canbus>https://github.com/an-dr/zklib_arduino_canbus</a></li><li>ESP-IDF: <a href=https://github.com/an-dr/zklib_espidf_canbus>https://github.com/an-dr/zklib_espidf_canbus</a></li><li>STM32: <a href=https://github.com/an-dr/zklib_stm32_canbus>https://github.com/an-dr/zklib_stm32_canbus</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://zakhar-the-robot.github.io/doc//commit/64ba958370321caa7f13d1dcabb5f7121843748a title="Last modified by Andrei Gramakov |  2022-May-06" target=_blank rel=noopener><img src=/doc/svg/calendar.svg class=book-icon alt=Calendar>
<span>2022-May-06</span></a></div></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#addressing>Addressing</a></li><li><a href=#standard-versioning>Standard Versioning</a></li><li><a href=#internal-error-codes>Internal Error Codes</a></li><li><a href=#data-types>Data Types</a></li><li><a href=#operations>Operations</a><ul><li><a href=#send-data>Send data</a></li><li><a href=#request-data>Request data</a></li><li><a href=#declare-the-presence>Declare the Presence</a></li></ul></li><li><a href=#compatible-libraries>Compatible libraries</a></li></ul></nav></div></aside></main></body></html>